
<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>ScriptAPI NPMs - WavePlayz</title>
		<style>

html {
	background: hsl(0, 0%, 8%);
	color: #ddd;
	font-family: monospace;
}


body, div {
	display: flex;
	flex-direction: column;
	border-radius: 10px;
	gap: .5em;
}

body {
	padding: calc( 1.25vh * 6 ) 0;
	align-items: center;
	gap: 1.25vh;
}

.module {
	background: hsl(0, 0%, 12%);
	margin: .5em .75em;
	padding: max(1.25em, 1.25vh);
	box-shadow: 
		-2px 2px 0px hsl(0, 0%, 6%) inset,
		2px -2px 0px hsl(0, 0%, 14%) inset,
		0 0 5px 5px hsl(0, 0%, 8%)
	;
	transition: 500ms;
}

.module b~b {
	color: orange;
	margin-top: .75em;
}

.module span {
	opacity: .75;
}

#info {
	flex-direction: row;
	font-size: smaller;
	z-index: 1;
	background: black;
	padding: 1em 2em;
	gap: 2ch;
}

.loading {
	opacity: .5;
	transform: scale(.95);
	filter: invert(50%) brightness(25%);
	background: hsl(0, 0%, 6%);
}

:hover {
	color: white;
}


		</style>
	</head>
	
	<body>

<div id=info>
	<b>WavePlayz</b>
	<span>v0.2.0</span>
</div>

<div>
<a href="#" onclick=fetchAll()>Fetch All</a>

</div>
		<script>

console.log()

const BASE_URL = "https://registry.npmjs.org/"
const NAMESPACE = "@minecraft"
const MODULES = [
	"server",
	"server-ui",
	"server-gametest",
	"server-editor",
	"server-admin",
	"server-net",
	"vanilla-data",
	"common"
]

const STABLE_REG = /^(\d+\.){2}\d+$/g
const STABLE_BETA_REG = /^(\d+\.){2}\d+.*stable$/g
const PREVIEW_REG = /^(\d+\.){2}\d+-rc.*preview/g
const PREVIEW_BETA_REG = /^(\d+\.){2}\d+-beta.*preview/g

const REG = [
	[ "Stable", STABLE_REG ],
	[ "Stable Beta", STABLE_BETA_REG ],
	[ "Preview", PREVIEW_REG ],
	[ "Preview Beta", PREVIEW_BETA_REG ]
]

function elm (value) {
	return document.createElement( value )
}

let moduleElms = MODULES.map( module => {
	let package = NAMESPACE + "/" + module
	let url = BASE_URL + package
	
	let div = elm( "div" )
	let { classList } = div
	classList.add("module")
	
	div.innerHTML = `<b>${ package }</b>`
	
	div.onclick = async function run() {
		this.onclick = null
		
		classList.add( "loading" )
		
		let versions

		try {
			versions = await fetchModuleVersions( url )
			
		} catch (err) {
			this.onclick = run
			
			alert(err.stack)
		}
		
		classList.remove( "loading" )
		
		if (! versions?.length ) return;
		
		
		
		for (let [ label, version ] of indexVersions(versions) ) {
			let npmString = "npm i " + package + "@" + version
			
			let labelElm = elm( "b" )
			labelElm.innerHTML = label
			div.append(labelElm)
			
			let versionElm = elm( "span" )
			versionElm.innerHTML = npmString
			versionElm.onclick = () => 
				copy( npmString )
					.then( () => popup("Copied<br>" + npmString) )
					.catch( () => 
						prompt( "Copy", npmString ) 
					);
			
			div.append(versionElm)
		}
		
	}
	
	document.body.append( div )
	
	return div
} )

async function fetchModuleVersions (url) {
	let content = await fetch( url, {
		headers: {
			// get trimed response
			"Accept": "application/vnd.npm.install-v1+json"
		}
	})
	
	let json = await content.json()
	
	return Object.keys( json.versions )
}

function indexVersions (versions) {
	let index = []
	
	versions.forEach( version => {
		REG.find( ([ label, reg ], i) => {
			index[i] = reg.test( version )
				? [ label, version ]
				: []
		} )
	} )
	
	console.log( index )
	
	return index
}

// from stack-overflow comment
function copy(text) {
	return new Promise((resolve, reject) => {
		if (typeof navigator !== "undefined" && typeof navigator.clipboard !== "undefined" && navigator.permissions !== "undefined") {
			const type = "text/plain";
			const blob = new Blob([text], { type });
			const data = [new ClipboardItem({ [type]: blob })];
			navigator.permissions.query({name: "clipboard-write"}).then((permission) => {
				if (permission.state === "granted" || permission.state === "prompt") {
					navigator.clipboard.write(data).then(resolve, reject).catch(reject);
				}
				else {
					reject(new Error("Permission not granted!"));
				}
			});
		}
		else if (document.queryCommandSupported && document.queryCommandSupported("copy")) {
			var textarea = document.createElement("textarea");
			textarea.textContent = text;
			textarea.style.position = "fixed";
			textarea.style.width = '2em';
			textarea.style.height = '2em';
			textarea.style.padding = 0;
			textarea.style.border = 'none';
			textarea.style.outline = 'none';
			textarea.style.boxShadow = 'none';
			textarea.style.background = 'transparent';
			document.body.appendChild(textarea);
			textarea.focus();
			textarea.select();
			try {
				document.execCommand("copy");
				document.body.removeChild(textarea);
				resolve();
			}
			catch (e) {
				document.body.removeChild(textarea);
				reject(e);
			}
		}
		else {
			reject(new Error("None of copying methods are supported by this browser!"));
		}
	});
}


function fetchAll(callback) {
	while (moduleElms.length) {
		moduleElms.pop()?.click()
	}
}

function popup (content) {
	if (! popup.stack) {
		let a = elm( "div" )
		
		Object.assign( a.style, {
			position: "fixed",
			top: 0,
			left: 0,
			right: 0,
			display: "flex",
			flexDirection: "column",
			alignItems: "end",
			//justifyContent: "center"
			gap: "1em",
			zIndex: 2,
			padding: "10%"
		})
		
		popup.stack = a
		
		document.body.append(popup.stack)
	}
	
	let b = elm( "div" )
	Object.assign( b.style, {
		background: "black",
		padding: ".5em 1em",
		transition: "500ms",
		opacity: 0
	})
	b.innerHTML = content
	
	setTimeout( () => (b.style.opacity = 1), 1 )
	popup.stack.append(b)
	
	setTimeout( () => {
		b.ontransitionend = () => b.remove()
		b.style.opacity = 0
	}, 1000 * 10 )
}

popup("Created By WavePlayz")

		</script>
	</body>
</html>




